<?php
	require_once('./lib/nusoap.php');
try {
	//$endpoint = "http://nrh.dyndns.org/demo/labReport.php";
	//$myNamespace = "http://nrh.dyndns.org/demo/labReport.php?wsdl";
	$endpoint = "http://nrh.dyndns.org/production/labReport.php";
	$myNamespace = "http://nrh.dyndns.org/production/labReport.php?wsdl";
	$wsdl = $myNamespace;
	$client = new nusoap_client($wsdl,"wsdl");//or die("eeee"); 
	//$client = new nusoap_client($endpoint, false);
	$xmls='<?xml version="1.0" encoding="UTF-8"?><ClinicalDocument xmlns="urn:hl7-org:v3" xmlns:voc="urn:hl7-org:v3/voc" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:hl7-org:v3 CDA.xsd"><typeId root="2.16.840.1.113883.1.3" extension="POCD_HD000040"/><id displayable="false"/><code displayName="Lab Report"/><effectiveTime value="2013103016000"/><confidentialityCode code="N" codeSystem="2.16.840.1.113883.5.25"/><setId root="DocumentID" extension="11470.11470-00001.2"/><versionNumber value="1"/><recordTarget><patientRole><id assigningAuthorityName="โรงพยาบาลนพรัตนราชธานี" extension="11470" root="HospCode"/><patient><id extension="1" root="HN"/><name><given>สมชาย</given><family>นามสกุลดี</family><prefix>นาย</prefix></name></patient></patientRole></recordTarget><author><time value="2013103016000"/><assignedAuthor><id assigningAuthorityName="PMK HIS"/><assignedAuthoringDevice><softwareName>PMK HIS</softwareName></assignedAuthoringDevice></assignedAuthor></author><custodian><assignedCustodian><representedCustodianOrganization><id assigningAuthorityName="พยาธิวิทยา"/><name>พยาธิวิทยา</name></representedCustodianOrganization></assignedCustodian></custodian><component><structuredBody><component><section><title>Lab Report</title><text>...</text><entry><labReport><patient><citizenID>3000000000001</citizenID><personName><prefix>นาย</prefix><givenName>สมชาย</givenName><middleName></middleName><familyName>นามสกุลดี</familyName></personName><birthdate>1983-02-28</birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender>M</gender><religion></religion><lifeStatus></lifeStatus><telephone>0810000001</telephone><email>som@gmail.com</email><hospCode>11470</hospCode><age></age><hospitalNumber>1</hospitalNumber><admissionNumber></admissionNumber><bloodTypeABO>A</bloodTypeABO><bloodTypeRh>Positive</bloodTypeRh><preDiagnosis></preDiagnosis><insType></insType></patient><labResult><VN>11470-00001</VN><labID>2</labID><labName>Chemistry</labName><labDate>2013-10-20 10:51:00</labDate><wardID>1</wardID><wardName>อายุรกรรม</wardName><labRequester><citizenID>1</citizenID><personName><prefix></prefix><givenName>วิวัฒน์</givenName><middleName></middleName><familyName>บุญรักษา</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labRequester><labResultDetail><LN></LN><labTestID>1</labTestID><universalTestName>SUGAR</universalTestName><methodID></methodID><methodName></methodName><resultTest>98.0</resultTest><referenceResultTest></referenceResultTest><unitID>1</unitID><unitName>mg/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>2</labTestID><universalTestName>BUN</universalTestName><methodID></methodID><methodName></methodName><resultTest>15.5</resultTest><referenceResultTest></referenceResultTest><unitID>1</unitID><unitName>mg/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>3</labTestID><universalTestName>CREATININE</universalTestName><methodID></methodID><methodName></methodName><resultTest>1.0</resultTest><referenceResultTest></referenceResultTest><unitID>1</unitID><unitName>mg/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>4</labTestID><universalTestName>URIC ACID</universalTestName><methodID></methodID><methodName></methodName><resultTest>5.5</resultTest><referenceResultTest></referenceResultTest><unitID>1</unitID><unitName>mg/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>5</labTestID><universalTestName>CHOLESTEROL</universalTestName><methodID></methodID><methodName></methodName><resultTest>200</resultTest><referenceResultTest></referenceResultTest><unitID>1</unitID><unitName>mg/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>6</labTestID><universalTestName>TOTAL PROTEIN</universalTestName><methodID></methodID><methodName></methodName><resultTest>7.5</resultTest><referenceResultTest></referenceResultTest><unitID>2</unitID><unitName>g/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>7</labTestID><universalTestName>ALBUMIN</universalTestName><methodID></methodID><methodName></methodName><resultTest>5.3</resultTest><referenceResultTest></referenceResultTest><unitID>2</unitID><unitName>g/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>8</labTestID><universalTestName>GLOBULIN</universalTestName><methodID></methodID><methodName></methodName><resultTest>3.1</resultTest><referenceResultTest></referenceResultTest><unitID>2</unitID><unitName>g/dl</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>9</labTestID><universalTestName>AST</universalTestName><methodID></methodID><methodName></methodName><resultTest>25.0</resultTest><referenceResultTest></referenceResultTest><unitID>3</unitID><unitName>U/L</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>10</labTestID><universalTestName>ALT</universalTestName><methodID></methodID><methodName></methodName><resultTest>21.5</resultTest><referenceResultTest></referenceResultTest><unitID>3</unitID><unitName>U/L</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail><labResultDetail><LN></LN><labTestID>11</labTestID><universalTestName>ALKALINE PHOSPHATASE</universalTestName><methodID></methodID><methodName></methodName><resultTest>100.0</resultTest><referenceResultTest></referenceResultTest><unitID>3</unitID><unitName>U/L</unitName><labResultDate>2013-10-20 10:51:00</labResultDate><resultUniversal></resultUniversal><referenceUniversal></referenceUniversal><unitUniversal></unitUniversal><labReporter><citizenID>1</citizenID><personName><prefix></prefix><givenName>สมหญิง</givenName><middleName></middleName><familyName>สุดสวย</familyName></personName><birthdate></birthdate><birthJurisdictionCountrySubDivision></birthJurisdictionCountrySubDivision><nationality></nationality><gender></gender><religion></religion><lifeStatus></lifeStatus><telephone></telephone><email></email></labReporter></labResultDetail></labResult></labReport></entry></section></component></structuredBody></component></ClinicalDocument>
';
	
	$xmlr = new SimpleXMLElement("<CustomerSearch></CustomerSearch>");
$xmlr->addChild('AuthorID', $authorID);
$xmlr->addChild('UserID', $userID);
$xmlr->addChild('UserPassword', $userPassword);
$xmlr->addChild('Email', $customerEmail);

$params = new stdClass();
$params->xml = $xmlr->asXML();

//print_r($params);
	$proxy = $client->getProxy(); 
	//$result = $proxy->InsertLab($xmls);	
	$result = $client->call("InsertLab", array("xml" => $params));//or die("ttttttttttttttt");	
	//$result = $client->send($msg, $endpoint)or die("ttttttttttttttt");
	
	if ($client->fault) {
		trigger_error("SOAP Fault: (faultcode: {$result->faultcode}, faultstring: {$result->faulstring})", E_ERROR);
	} else {
		// Check for errors
		$err = $client->getError();
		if ($err) {
			// Display the error
			echo '<h2>Error</h2><pre>' . $err . '</pre>';
		} else {
			// Display the result
			echo '<h2>Result</h2><pre>';
			echo $result;
			print_r($result);
			echo '</pre>';
		}
	}
	
	
//echo $result;
//print_r($result);
//echo"xxxxxxxxxxxxxx";
} catch (Exception $e) {
		printf("MessAge = %s\n",$e->getMessAge());
}
?>
